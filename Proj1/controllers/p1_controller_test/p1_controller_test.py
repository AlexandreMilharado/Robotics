import sys
import os


# Add the parent 'controllers' directory to sys.path
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from p1_util.evolution_manager import Evolution_Manager
from p1_util.Individual import Individual
from p1_util.Networks import ComplexNet, SimpleNet


# Simulation parameters
    # Webots
TIME_STEP_MULTIPLIER = 6.4                      # Webots timestep 
EVALUATION_TIME = 100                           # Simulated seconds per individual

    # Evolutionary
        # Model
INDIVIDUAL_TYPE = "NETWORKS_COMPLEX"            # "BRAITENBERG" | "NETWORKS_SIMPLE" | "NETWORKS_COMPLEX"
GET_LAST_GEN = False
GEN_DUMMY = 0

# Saving and Loading
INDIVIDUALS_HISTORY_PATH_BRAITENBERG = "../p1_util/experiements/braitenberg/1/evolutionary.csv"    # Path for Individuals History
BEST_INDIVIDUAL_PATH_BRAITENBERG = "../p1_util/experiements/braitenberg/1/best_individual.pkl"     # Path for Best Individual

INDIVIDUALS_HISTORY_PATH_SIMPLE_NET = "../p1_util/experiements/simple_net/best/evolutionary.csv"    # Path for Individuals History
BEST_INDIVIDUAL_PATH_SIMPLE_NET = "../p1_util/experiements/simple_net/best/best_individual.pkl"     # Path for Best Individual

INDIVIDUALS_HISTORY_PATH_COMPLEX_NET = "../p1_util/experiements/complex_net/best/evolutionary.csv"    # Path for Individuals History
BEST_INDIVIDUAL_PATH_COMPLEX_NET = "../p1_util/experiements/complex_net/best/best_individual.pkl"     # Path for Best Individual

# Main evolutionary loop
def main():
    match INDIVIDUAL_TYPE:
        case "BRAITENBERG":
            path_history = INDIVIDUALS_HISTORY_PATH_BRAITENBERG
            path_individual = BEST_INDIVIDUAL_PATH_BRAITENBERG

            #TODO Uncomment to run 720 Individual 
            # individual = Individual(GEN_DUMMY, 720, [0.5818134621986009, 0.13865807793908047, 0.8125796317561428, 1, 0.24085906907650848, 0.40787192861437127])

            #TODO Uncomment to run 1126 Individual 
            # individual = Individual(GEN_DUMMY, 1126, [0.18918084857689133, 0.23754154363231408, 0.7202805237750275, 0.9845485173658222, 0.4276338615388701, -0.12603463192806347])

            #TODO Uncomment to run 3102 Individual  
            individual = Individual(GEN_DUMMY, 3102, [1, 0.44862598044379165, 0.48194306541659676, 0.8586086049567916, 0.9521240186655022, 0.03753195123846662])

        case "NETWORKS_SIMPLE":
            # Best Individual on last Generation
            path_history = INDIVIDUALS_HISTORY_PATH_SIMPLE_NET
            path_individual = BEST_INDIVIDUAL_PATH_SIMPLE_NET

            #TODO Uncomment to run 1637 Individual
            # individual = SimpleNet(GEN_DUMMY, 1637, [-0.043621383491984744, 0.07145413568572226, -1, 0.3010024940572799, 0.5976408592119722, 0.8762950694381357, -1, -0.09577434796970619, 0.955340669001795, 0.24301711129691567, -0.756754061100468, -0.7719266165011337, 0.5377076746054196, -1, 0.9969978025526554, -1, 0.8874557601884197, -1, 0.8548485406744881, -0.362445586493663, -0.18512840744961911, 0.16594878006229025])
            
            #TODO Uncomment to run 3125 Individual
            # individual = SimpleNet(GEN_DUMMY, 3125, [0.5869619680235721, -0.9795696539104428, -0.7916821602783721, -0.8441546725546328, 0.9751658354941617, 0.8985716428667162, -0.9442268592130283, -0.38396608524310544, -0.3388930258220551, 0.8701585973687939, -0.7898464989766424, -0.5841368400625375, -0.7755439089406573, -0.9136484460226939, 0.8993666743270459, -0.9850006322087818, -0.9651707424083783, 0.07213926100975632, 0.9708071331851227, 0.44505857270231775, -0.5687979394377852, 0.9698723162524023])
            
            #TODO Uncomment to run 7221 Individual
            individual = SimpleNet(GEN_DUMMY, 7221, [-0.9484698409854921, 0.6598759107773684, -0.5095500921534255, -0.8614541022863407, 0.7987480117135004, 0.5916484153637585, -0.30942366969565094, -0.24405961604694743, -0.9012619357772516, 0.730737112752867, -0.028453911870992263, -1.0, -0.8881204985511026, -0.6769560352517451, 0.1136556914717895, 0.2887521061208912, -0.05115651031046836, -0.9905591879847275, 1.0, -0.5318621298911128, 0.9941904945064516, 0.21732206108884689])
        
        case _:
            path_history = INDIVIDUALS_HISTORY_PATH_COMPLEX_NET
            path_individual = BEST_INDIVIDUAL_PATH_COMPLEX_NET

            #TODO Uncomment to run 759 Individual
            # individual = ComplexNet(GEN_DUMMY, 759,[0.04579802377021036, -0.8038303114096843, 0.757789212716654, 0.35336277093712354, 0.6590790943804846, 0.14660076119269594, -0.7741099898485932, -0.6566691250294531, -0.3722423486885348, -0.5322733240081934, 0.49921946766567826, -0.9605769038933454, 0.5902993842763692, -0.9881127910259515, 0.8523777265287815, -0.2694786103063015, -0.5197012607372529, -0.7680987557415697, 0.39566083158043597, 0.6154669526621999, 0.9732797591324032, -0.11431059486020101, -0.0769228451076662, -0.37518719392971245, -0.534503366509849, -0.3888543385286941, -0.08356767882434102, -0.7112871182278044, -0.47799454191644775, 0.8175257503424745, -0.0896587927191761, -0.055441501615948595, 0.3006283590255361, 0.1485947906957199, -0.19462091080401722, 0.9948251576332002, 0.38725986413057767, 0.44232756971864573, -0.1385292248303029, 0.24076206461290428, -0.22852610360167383, -0.7756565445314817, -0.39019631853421843, -0.13188643444747133, -0.742625903291929, 0.5102595114314609, 0.3496508765725257, 0.17501072165940967, 0.2294618675046593, -0.5658717470156535, -0.42628166364924397, -0.48517321638137223, -0.37243362591598045, -0.2990352570662682, 0.6133752501268996, -0.07176567663061906, -0.46385164347054353, 0.07206575085933797, -0.4437975194834619, -0.33226192357207973, 0.32621478279463023, -0.27014883391993383, -0.3755917885392608, -0.2576402317870376, 0.1802918147974042, 0.19443950501604823, -0.8316049257255711, 0.16853947645166212, -0.09537851562140308, 0.31710785231488975, -0.4865365916670187, 0.821370827950814, -0.8911352125988953, 0.42314986467408233, -0.7998340664907286, -0.5111083696404687, 0.5535452387803127, -0.6475465393346002, 0.5258392773141766, 0.9587717144128778, 0.3077452934566718, -0.32385796655637156, 0.1115214566255357, 0.7026434957452923, -0.34462000087452505, -0.17639459300852647, -0.3125548737755668, -0.0038051038437881823, -0.11306850439708555, 0.700241619276719, -0.23172955424852376, -0.27925989531496204, -0.0016318313626679792, -0.3865146842487772, -0.4932937936981863, -0.11775962810563818, 0.5447311562199029, 0.4420979769555115, 0.5304625648563899, -0.49148017388793597, 0.05643386490469083, 0.8988936620252205, 0.7809857761366568, -0.0720323128933531, 0.5808139526409994, 0.9059736811943511, 0.5924442184150917, 0.23691859847145047, 0.34779085536159327, -0.37463649610154826, -0.23218840571141508, 0.37934079213530414])

            #TODO Uncomment to run 759 Individual
            individual = ComplexNet(GEN_DUMMY, 10323,[0.0413961891180703, -0.7763382807468471, 0.36815177764787343, 0.054382870499472824, -0.13017643872777046, -0.16115487272789253, 0.11693457896415335, -0.050064335988319525, -0.2009742380524358, 0.15666488319256655, 0.25207379563621973, 0.5138133993176477, -0.38451849682004346, 0.736193598083517, -0.15231516149247623, -0.5110869900985064, -0.23827042541503646, 0.3651989639629081, 0.7572880030656246, -0.5868799956403499, -0.4387451726078686, 0.13187730335181425, -0.5070277960585023, 0.6518033092522002, -0.2828886388696973, -0.5495799820594146, 0.20622028194442737, 0.3518484555831211, 0.16203261928988089, 0.29022454782877943, 0.2437591884081578, -0.6245491230385688, 0.252983755806809, -0.02277831139913743, 0.2728545131310049, -0.0432097556057596, -0.9507388454786452, -0.21256712547737927, 0.055471917686247776, -0.19818162612422022, 0.24169805495089186, -0.6796380669201616, 0.7945212873633531, 0.11320707328654181, -0.45970322302088396, 0.026905321428980264, 0.3494216471990945, 0.19648960719675496, -0.07241893979446795, 0.10036548852343008, -0.2852312249279808, -0.26384105578456507, 0.5505345833213569, -0.5082849974157776, -0.449876214498684, -0.13064769705817944, -0.027109587588289047, -0.8109398123962694, 0.4865511726868683, 0.4457837496565156, -0.015086157200606326, -0.6710288313319592, -0.5561449083424116, 0.4665161567388754, -0.49256597451806294, -0.5175878777651544, -0.10058717675232415, 0.04727087361560603, 0.29766496251374275, -0.09293180050575223, 0.15821998647429256, -0.5971883032505885, -0.12168264498070866, -0.29034874379053477, 0.043098962858715964, -0.31815137647463754, 0.23431265511074323, 0.0923046124469623, 0.41666661029354757, -0.2307914143900064, 0.7354083036923631, 0.28536227534375225, 0.2053064877894754, 0.6072093170552856, 0.4348532650907302, 0.3226603816926743, -0.02670986547717312, 0.37741763215991325, 0.11109320806184537, -0.4914060200951735, -0.1626292718770026, -0.5116482654238277, -0.36628967087810615, -0.7950183373627817, -0.4116294879054656, -0.09564247487000763, 0.21911770633553865, -0.24925470279204837, 0.1318641518569612, 0.4338516380890862, -0.26104622667367317, 0.26515179005270434, -0.5072407934174802, -0.0433318967516334, 0.8626591223382684, -0.7988616806232736, -0.6972443354682786, 0.08406039814130241, 0.39362757915300817, 0.4054595407238152, 0.22033896562580402, -0.8300886131122405])


    # Run the evolutionary algorithm
    controller = Evolution_Manager( INDIVIDUAL_TYPE = INDIVIDUAL_TYPE,
                                    TIMESTEP_MULTIPLIER = TIME_STEP_MULTIPLIER,
                                    INDIVIDUALS_HISTORY_PATH = path_history,
                                    BEST_INDIVIDUAL_PATH = path_individual)

    if GET_LAST_GEN:
        individual = controller.load_best_individual_on_last_gen()
      
    controller.run_individual(individual)

if __name__ == "__main__":
    main()